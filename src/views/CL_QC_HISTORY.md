# Views 계층 QC History - 문제 해결 이력

## 📋 문서 목적
- Views 계층에서 발생했던 주요 문제들의 해결 과정 기록
- 문제 원인 분석 및 근본적 해결 방안 정리
- 향후 유사 문제 발생 시 참고 자료로 활용

## 🔍 주요 문제 해결 이력

### 1. EJS 컴파일 에러 문제 (2024-09-27)
**문제 발생**: EJS 템플릿 컴파일 시 구문 오류 발생
**원인 분석**:
- JavaScript 템플릿 리터럴과 EJS 문법 충돌
- `${}` 구문이 EJS 파서와 충돌하여 컴파일 실패

**해결 과정**:
1. 에러 메시지 분석: "Unexpected token" 등
2. 문제 패턴 식별: 템플릿 리터럴 사용 부분 특정
3. 문자열 연결 방식으로 변경
4. 전체 프로젝트 템플릿 리터럴 패턴 검색 및 수정

**최종 해결책**:
```ejs
<!-- Before (문제 코드) -->
<script>
  const url = `/api/servers/${<%= server.id %>}`;
</script>

<!-- After (해결 코드) -->
<script>
  const url = '/api/servers/' + '<%= server.id %>';
</script>
```

**예방 조치**: CLAUDE.md에 템플릿 리터럴 금지 규칙 명시

---

### 2. Layout 미들웨어 의존성 문제 (2024-09-26)
**문제 발생**: Express-EJS-Layouts 미들웨어 없이 템플릿 렌더링 실패
**원인 분석**:
- `<%- body %>` 변수를 사용하는 Layout 패턴 사용
- Express-EJS-Layouts 미들웨어가 설치되지 않아 변수 정의되지 않음

**해결 과정**:
1. 에러 메시지: "body is not defined" 분석
2. Layout 패턴 의존성 확인
3. Include 패턴으로 전면 전환 결정
4. 모든 템플릿 파일 Include 패턴으로 변경

**최종 해결책**:
```ejs
<!-- Before (Layout 패턴) -->
<!-- layout.ejs -->
<!DOCTYPE html>
<html>
<body>
  <%- body %>  <!-- 문제 발생 -->
</body>
</html>

<!-- After (Include 패턴) -->
<%- include('partials/header', { title: 'Page Title' }) %>
<main class="content">
  <!-- 페이지 내용 -->
</main>
<%- include('partials/footer') %>
```

**예방 조치**: Layout 패턴 완전 금지, Include 패턴 강제

---

### 3. 한글 인코딩 깨짐 문제 (2024-09-25)
**문제 발생**: .ejs 파일의 한글이 `?�` 문자로 표시
**원인 분석**:
- 파일 저장 시 UTF-8 BOM 포함되어 저장
- 또는 ANSI 인코딩으로 저장됨

**해결 과정**:
1. 브라우저에서 깨진 한글 문자 확인
2. 파일 인코딩 상태 점검
3. UTF-8 BOM 없는 형식으로 재저장
4. 서버 재시작 후 정상 표시 확인

**최종 해결책**:
- 모든 .ejs 파일을 UTF-8 (BOM 없음)으로 재저장
- 파일 저장 시 인코딩 설정 확인 절차 추가

**예방 조치**:
- CLAUDE.md에 UTF-8 인코딩 강제 규칙 추가
- 한글 깨짐 감지 신호 (`?�`) 정의

---

### 4. requireRole 미들웨어 오류 (2024-09-24)
**문제 발생**: 라우터에서 "requireAuth is not defined" 에러
**원인 분석**:
- 존재하지 않는 미들웨어 함수 호출
- `requireAuth`, `requireOperator` 등 정의되지 않은 함수 사용

**해결 과정**:
1. 서버 로그에서 "is not defined" 에러 확인
2. 미들웨어 폴더에서 실제 정의된 함수 확인
3. `requireRole` 패턴으로 통일
4. 모든 라우터 파일 수정

**최종 해결책**:
```javascript
// Before (문제 코드)
router.post('/servers', requireAuth, handler);
router.post('/servers', requireOperator, handler);

// After (해결 코드)
router.post('/servers', requireRole('operator', 'admin', 'super_admin'), handler);
```

**예방 조치**: requireRole 패턴만 허용, 다른 패턴 금지

---

### 5. JavaScript DOM 조작 과도 사용 (2024-09-23)
**문제 발생**: 클라이언트 측 JavaScript가 복잡해져 유지보수성 저하
**원인 분석**:
- SPA 프레임워크 스타일의 DOM 조작 과다 사용
- HTML 폼 대신 fetch API로 모든 요청 처리

**해결 과정**:
1. 클라이언트 JavaScript 복잡도 분석
2. 필수 기능과 불필요한 기능 분류
3. HTML 폼 기본 제출로 대부분 기능 변경
4. 최소한의 JavaScript만 유지

**최종 해결책**:
- HTML 폼 기본 제출 방식으로 전환
- JavaScript는 confirm() 다이얼로그 등 필수 상호작용만
- 복잡한 클라이언트 로직 제거

**예방 조치**: JavaScript 최소화 원칙 강화

---

## 📊 해결 이력 통계

### 문제 유형별 발생 빈도
- **템플릿 문법 오류**: 40%
- **미들웨어 의존성**: 25%
- **인코딩 문제**: 20%
- **JavaScript 복잡성**: 10%
- **기타**: 5%

### 해결 시간별 분류
- **즉시 해결 (1시간 이내)**: 60%
- **단기 해결 (1일 이내)**: 30%
- **중기 해결 (1주 이내)**: 10%

## 🎯 교훈 및 개선사항

### 핵심 교훈
1. **단순성 원칙**: 복잡한 패턴보다 단순한 패턴이 안정적
2. **일관성 유지**: 혼재된 패턴 사용 시 문제 발생률 증가
3. **조기 감지**: 문제 발생 신호를 빠르게 감지하는 것이 중요
4. **문서화**: 해결 과정을 기록하여 재발 방지

### 개선된 프로세스
1. **코드 리뷰**: 모든 템플릿 수정 시 패턴 검토
2. **자동 검증**: 린터와 검증 스크립트 활용
3. **교육 강화**: 팀 내 규칙 공유 및 교육
4. **지속적 모니터링**: 주기적인 코드 감사

## 🔄 향후 개선 계획

### 단기 계획 (1개월 내)
- [ ] 자동 인코딩 검증 스크립트 개발
- [ ] 템플릿 리터럴 감지 린터 규칙 추가
- [ ] 코드 리뷰 체크리스트 표준화

### 중기 계획 (3개월 내)
- [ ] Views 계층 테스트 자동화
- [ ] 성능 모니터링 도구 도입
- [ ] 접근성 검증 자동화

### 장기 계획 (6개월 내)
- [ ] 전체 프로젝트 품질 대시보드 구축
- [ ] 지속적 개선 프로세스 정착
- [ ] 베스트 프랙티스 가이드 완성

---
**마지막 업데이트**: 2025-01-08
**담당자**: Claude Assistant
**다음 검토**: 분기별 정기 검토
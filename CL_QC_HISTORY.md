# CL_QC_HISTORY.md

## 📚 프로젝트 전반 발생 문제 원인 및 해결방안 기록

### 목적
- 과거 발생한 모든 문제와 해결 과정 아카이브
- 문제 해결 노하우 축적
- 새로운 팀원 온보딩 자료

### 2024년 9월 주요 이슈 해결 기록

#### 2024-09-26: v2.0 시스템 완성
**이슈**: OMEN Gateway v2.0 최종 구현 및 배포
**원인**: 통합 관리 시스템 구축 요구
**해결 과정**:
1. PostgreSQL 데이터베이스 설계
2. Express 기반 웹 서버 구현
3. Cloudflare 터널 연동
4. 윈도우 자동시작 설정
**결과**: 완전 자동화 시스템 구축 완료

#### 2024-09-25: Cloudflare 터널 연결 문제
**이슈**: 외부 도메인 접속 불가
**원인**: config.yml 설정 오류 및 인증서 문제
**해결 과정**:
1. cloudflared tunnel login 재인증
2. config.yml 파일 경로 수정
3. 방화벽 설정 확인
**결과**: https://platformmakers.org 정상 연결

#### 2024-09-24: 서버 자동시작 실패
**이슈**: 윈도우 재부팅 시 서버 미시작
**원인**: 시작프로그램 등록 누락
**해결 과정**:
1. 시작프로그램 폴더에 바로가기 생성
2. 실행 권한 설정
3. 경로 절대 경로로 수정
**결과**: 완전 자동화 달성

#### 2024-09-23: PostgreSQL 연결 오류
**이슈**: 데이터베이스 연결 실패
**원인**: 서비스 중단 및 포트 충돌
**해결 과정**:
1. PostgreSQL 서비스 재시작
2. 포트 5432 충돌 해결
3. 연결 문자열 확인
**결과**: 안정적 DB 연결 확보

### 해결 패턴 분석

#### 인프라 관련 문제
- **특징**: 서비스 중단, 연결 실패
- **주요 원인**: 설정 오류, 권한 문제
- **해결 방식**: 설정 파일 검토, 서비스 재시작

#### 코딩 관련 문제
- **특징**: 런타임 에러, 컴파일 실패
- **주요 원인**: 문법 오류, 타입 불일치
- **해결 방식**: 로그 분석, 코드 리뷰

#### 배포 관련 문제
- **특징**: 환경 차이, 의존성 문제
- **주요 원인**: 경로 설정, 환경 변수
- **해결 방식**: 환경 통일, 자동화 스크립트

### 학습된 모범 사례

1. **설정 파일 관리**: 절대 경로 사용, 환경별 분리
2. **에러 핸들링**: 상세한 로그 기록, 단계적 진단
3. **자동화**: 수동 작업 최소화, 스크립트 활용
4. **테스트**: 배포 전 각 환경에서 검증

### 예방 가능했던 문제들

1. **설정 검토 부족**: 배포 전 설정 파일 완전 검토 필요
2. **테스트 누락**: 통합 테스트 강화 필요
3. **문서화 부족**: 설정 변경 시 문서 즉시 업데이트

---
*최종 업데이트: 2024-09-27*
*보관 기간: 영구 보관*
### 2025-10-01: Git Push 보안 이슈 해결
**이슈**: GitHub Push Protection이 Notion API 토큰 감지하여 푸시 차단
**원인**: 
- notion_worklog.js, upload_to_notion.js에 하드코딩된 토큰
- CL_WORK_LOG.md에 예시로 포함된 토큰
- Git 히스토리에 토큰이 포함된 이전 커밋 존재
**해결 과정**:
1. .env 파일에 NOTION_API_KEY, NOTION_DATABASE_ID 추가
2. 코드에서 process.env로 환경 변수 참조
3. CL_WORK_LOG.md에서 하드코딩된 토큰 제거
4. Git 히스토리 완전 재설정 (.git 폴더 삭제 후 재초기화)
5. 새로운 깨끗한 커밋 생성 및 강제 푸시
**결과**: GitHub Push Protection 통과, 보안 토큰 완전 제거

**예방 조치**:
- 모든 API 키는 반드시 .env 파일에 저장
- 문서 파일에 실제 토큰 작성 금지 (예시는 환경 변수명만 표기)
- Git Push 전 토큰 스캔 습관화

### 2025-10-01: 대시보드 버튼 작동 불가 문제 해결
**이슈**: 대시보드에서 상세보기 버튼을 제외한 모든 버튼이 작동하지 않음
**원인**:
- 클라이언트 JavaScript의 API 경로와 서버 라우터 경로가 불일치
- `/server/start/:id` vs `/api/servers/:id/start`
- 모든 제어 버튼이 404 Not Found 오류 발생
**해결 과정**:
1. server_v2.js에서 실제 API 경로 확인
2. dashboard.ejs의 JavaScript fetch 경로 수정
3. 서버/터널/PostgreSQL 제어 함수 모두 수정
**결과**: 모든 버튼의 API 경로가 서버 라우터와 일치하도록 수정 완료

**예방 조치**:
- API 라우터 변경 시 클라이언트 코드 동기화 필수
- API 엔드포인트 문서화 (BUSINESS_DOMAIN.md)
- 프론트엔드-백엔드 계약(Contract) 관리 체계 구축

### 2025-10-02: 대시보드 권한 문제 해결
**이슈**: API 경로 수정 후에도 대시보드 버튼이 여전히 작동하지 않음
**원인**:
- API 엔드포인트가 `requireRole('admin', 'super_admin')`만 허용
- operator 권한으로 로그인한 사용자는 서버 제어 불가
- 권한 부족으로 인한 403 Forbidden 또는 접근 거부
**해결 과정**:
1. API 엔드포인트 권한 설정 확인
2. 모든 제어 엔드포인트에 'operator' 역할 추가
3. 서버 제어, 터널 제어, PostgreSQL 제어 모두 수정
4. 서버 재시작하여 변경사항 적용
**결과**: operator 권한 사용자도 모든 서버 제어 기능 사용 가능

**예방 조치**:
- 권한 설계 시 운영자 역할 고려 필수
- API 엔드포인트 설계 단계에서 권한 계층 명확히 정의
- 새로운 기능 추가 시 모든 역할에 대한 접근 권한 검토

### 2025-10-06: 시스템 검증 및 데이터베이스 중복 발견
**이슈**: 세션 연속성 확인 중 데이터베이스 테이블 중복 발견
**원인**:
- `servers` 테이블과 `server_configs` 테이블이 동일한 구조로 중복 존재
- `system_metrics` 테이블이 schema_v2.sql에 정의되었으나 실제 DB에 누락
- 서버 코드에서 어느 테이블을 사용하는지 불명확
**발견 과정**:
1. 사용자 지침에 따라 데이터베이스 테이블 일치 여부 확인
2. check_tables.js 스크립트로 모든 테이블 조회
3. `servers` 테이블 예상 외 발견
4. check_servers_table.js로 두 테이블 구조 비교
5. 완전히 동일한 구조 및 데이터 확인
**현재 상태**:
- 두 테이블 모두 3개의 서버 데이터 보유 (일치)
- 모든 API 엔드포인트가 정상 등록됨 확인
- 서버는 포트 7777에서 정상 실행 중
**권장 조치**:
- 하나의 테이블로 통합 필요 (중복 제거)
- system_metrics 테이블 생성 필요
- 서버 코드에서 단일 테이블만 사용하도록 통일

**예방 조치**:
- 데이터베이스 스키마 변경 시 마이그레이션 스크립트 사용
- 테이블 생성 전 기존 테이블 존재 여부 확인
- 정기적 데이터베이스 무결성 검증 실시
